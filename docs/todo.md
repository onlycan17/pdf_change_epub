# PDF to EPUB 변환기 TODO 리스트

## 프로젝트 개요
Python 기반 PDF → EPUB 변환기로, 한국어 처리에 최적화되고 React 기반 웹 프론트엔드를 제공합니다. OCR 기술을 활용한 스캔 문서 지원, EPUB3 표준 준수, CLI/API 인터페이스를 목표로 합니다.

### 현재 상태
- 기본 프로젝트 구조 및 품질 인프라 완료
- Python 백엔드 개발 시작 단계
- 핵심 라이브러리 목록 업데이트 완료 (requirements.txt)

---

## 현재 작업 (M0: 프로젝트 초기 설정 및 설계 확정)

### 아키텍처 설계
- [x] 기술 스택 선정 (Python, FastAPI, React, PyPDF2/PaddleOCR, ebooklib)
- [x] 상세 아키텍처 다이어그램 작성 (서비스/도메인 레이어 분리)
- [x] 데이터 흐름 정의 (아래 두 워크플로우로 구체화)
    - **텍스트 PDF**: PDF 텍스트/이미지 직접 추출 → 1차 마크다운 생성 → LLM 텍스트 보정 → 2차 마크다운 업데이트 → EPUB 생성
    - **스캔 PDF**: 에이전트 기반 처리 (멀티모달 LLM으로 이미지 분석 + OCR로 텍스트 추출) → 1차 마크다운 생성 → LLM 텍스트 보정 → 2차 마크다운 업데이트 → EPUB 생성
- [x] 의존성 주입 방식 결정 (FastAPI의 `Depends` 활용)

### 개발 환경 완성
- [x] Python 가상 환경 설정 (.venv)
- [x] 품질 도구 설치 (`make fmt`, `make lint`, `make test` 확인)
- [x] 핵심 라이브러리 의존성 정의 완료 (requirements.txt 업데이트)
- [x] IDE/개발 환경 최적화 (VSCode Python 확장자 설정)
- [x] 디버깅 환경 구축 (logging, breakpoint 설정) - 2025-09-19 완료

### 버그 수정: create_dependency_chain awaitable 오류
- [x] 대분류: 원인 분석
  - [x] 중분류: Pylance 경고 재현 및 로그 수집
  - [x] 중분류: 동기 의존성 사용 사례 확인 (예: `get_settings_dependency`)
- [x] 대분류: 해결책 설계
  - [x] 중분류: 비동기/동기 분기 처리 필요성 정의
  - [x] 중분류: 결과 타입(설정 객체, `Depends`) 혼합 처리 전략 정리
- [x] 대분류: 구현 및 검증
  - [x] 중분류: `create_dependency_chain` 로직 수정
  - [x] 중분류: `make fmt && make test && make lint` 실행
  - [x] 중분류: 문서 최신화 및 회고 기록

#### 진행 로그
- 2025-09-19: `inspect.isawaitable`을 사용해 동기/비동기 의존성을 모두 처리하도록 `create_dependency_chain`을 보완하고, `Depends` 객체 직접 전달 시 재포장하지 않도록 분기 추가.

### 버그 수정: Pylance isinstance 타입 오류
- [x] 대분류: 원인 분석
  - [x] 중분류: `Depends` 타입 정의 확인
  - [x] 중분류: 기존 isinstance 분기 동작 방식 점검
- [x] 대분류: 해결책 설계
  - [x] 중분류: FastAPI 실제 `Depends` 클래스 타입 확인 방법 정리
  - [x] 중분류: 대체 검사 방식(예: `fastapi.params.Depends`) 결정
- [x] 대분류: 구현 및 검증
  - [x] 중분류: `create_dependency_chain`의 `Depends` 분기 수정
  - [x] 중분류: `make fmt && make test && make lint` 재실행
  - [x] 중분류: 문서 최신화 및 회고 기록

#### 진행 로그
- 2025-09-19: FastAPI `Depends` 타입을 `fastapi.params.Depends`로 식별하도록 수정하고 정적 분석/테스트를 재실행하여 경고가 사라짐을 확인.

### 버그 수정: PDFAnalyzer bytes.read 경고 처리
- [x] 대분류: 원인 분석
  - [x] 중분류: Pylance 경고 발생 위치(`analyze_pdf`) 확인
  - [x] 중분류: `Union[bytes, BytesIO]` 분기 제한 사항 정리
- [x] 대분류: 해결책 설계
  - [x] 중분류: 안전한 타입 가드/사용자 정의 프로토콜 도입 여부 결정
  - [x] 중분류: `isinstance` 기반 분기와 예외 처리 전략 확정
- [x] 대분류: 구현 및 검증
  - [x] 중분류: `analyze_pdf` 분기 수정 및 정적 검사 재실행
  - [x] 중분류: 회귀 테스트(`make fmt && make test && make lint`) 실행
  - [x] 중분류: 문서 최신화 및 회고 기록

#### 진행 로그
- 2025-09-22: `PDFContentSource` 타입 별칭과 `_read_pdf_bytes` 헬퍼로 입력 분기를 표준화하고, `PDFAnalyzer`/`PDFExtractor`에 적용 후 `make fmt && make test && make lint`로 검증 완료.

---

## 다음 단계 후보

### M1: 코어 파이프라인 구현 (2주)
**목표**: PDF 추출, OCR 처리, EPUB 생성 기본 기능 완성

**코어 추출 모듈 개발**
- [x] PDF 분석 모듈 설계 (텍스트 기반 vs. 스캔 기반 자동 감지)
- [x] **워크플로우 A (텍스트 PDF)**: PyPDF2/pdfminer.six를 사용한 텍스트 및 이미지 직접 추출 기능 구현
- [x] **워크플로우 B (스캔 PDF)**: 에이전트 기반 처리 모듈 설계
    - [x] OpenRouter 연동 멀티모달 LLM 에이전트 개발 (이미지 컨텍스트 분석 및 설명 생성)
    - [x] PaddleOCR 연동 에이전트 개발 (페이지별 텍스트 추출)
    - [x] 에이전트 결과 종합 및 마크다운 생성 로직 구현
- [x] 메타데이터 (제목, 저자 등) 추출 기능

**EPUB 생성 모듈**
- [ ] EPUB3 표준 준수 구조 설계
- [ ] ebooklib을 활용한 EPUB 생성기 개발
- [ ] 목차 자동 생성 알고리즘 (제목 기준)
- [ ] 이미지 최적화 및 WebP 변환
- [ ] 스타일시트(CSS) 적용 및 가독성 개선
- [ ] EPUB 유효성 검증 기능

**변환 오케이스트레이션**
- [ ] 변환 파이프라인 통합 관리자 개발
- [ ] 단계별 진행 상태 추적 시스템
- [ ] 에러 핸들링 및 복구 메커니즘
- [ ] 대용량 문서를 위한 청크 단위 처리 로직 구현
- [ ] 메모리 사용량 최적화 (대용량 PDF 지원)

**CLI 인터페이스**
- [ ] Click 프레임워크 기반 CLI 개발
- [ ] 명령행 옵션 설계 (파일 경로, 언어 선택 등)
- [ ] 진행 상황 프로그레스 바 표시
- [ ] 결과 파일 저장 위치 옵션

### M2: API 및 웹 프론트엔드 (3주)
**목표**: FastAPI 기반 API, React 웹 인터페이스 완성

**REST API 개발 및 결제**
- [ ] FastAPI 애플리케이션 구조 설계
- [ ] 파일 업로드 엔드포인트 (`/api/upload`)
- [ ] 변환 처리 엔드포인트 (`/api/convert`)
- [ ] 상태 조회 엔드포인트 (`/api/status/{task_id}`)
- [ ] 결과 다운로드 엔드포인트 (`/api/download/{task_id}`)
- [ ] 지원 언어 목록 엔드포인트 (`/api/languages`)
- [ ] 비동기 처리를 위한 Celery/RQ 도입
- [ ] API 인증 시스템 (기본 토큰 기반)
- [ ] 요청/응답 데이터 검증 (Pydantic 활용)
- [ ] LLM 사용량 기반 가격 산정 모델 설계
- [ ] 결제 시스템 연동 (Stripe/포트원)

**React 웹 인터페이스**
- [ ] Vite + React 프로젝트 설정
- [ ] 컴포넌트 구조 설계 (페이지별 분리)
- [ ] 파일 드래그 앤 드롭 컴포넌트
- [ ] 변환 상태 실시간 표시 (WebSocket/SSE)
- [ ] 결과 미리보기 및 다운로드 UI
- [ ] 언어 선택 기능 (한국어/영어)
- [ ] 다크 모드 테마 구현
- [ ] 반응형 디자인 (모바일 지원)
- [ ] 접근성 보장 (a11y 최적화)

### M3: 고급 기능 및 품질 보증 (2주)
**목표**: 성능 최적화, 보안 강화, 테스트 커버리지 향상

**성능 최적화**
- [ ] 병렬 처리 도입 (multiprocessing)
- [ ] OCR 작업 큐 관리 Celery/RQ
- [ ] 대용량 PDF 처리 스트리밍 최적화
- [ ] 이미지/텍스트 캐싱 시스템 (Redis)
- [ ] 메모리 누수 방지 및 가비지 컬렉션

**보안 강화**
- [ ] 파일 업로드 검증 (확장자, 크기, 바이러스 스캔)
- [ ] 임시 파일 자동 삭제 메커니즘
- [ ] API 레이트 리밋링 (Slowloris 방어)
- [ ] XSS/CSRF 필터링
- [ ] 민감 정보 처리 로깅

**품질 보증**
- [ ] 단위 테스트 확장 (pytest, React Testing Library)
- [ ] 통합 테스트 작성 (API + DB 가짜 객체)
- [ ] E2E 테스트 Cypress 도입
- [ ] 성능 테스트 (locust 또는 k6)
- [ ] 코드 커버리지 80%+ 목표
- [ ] 정적 분석 자동화 (Snyk, SonarQube)

### M4: 배포 및 모니터링 (1주)
**목표**: 프로덕션 환경 배포 및 운영 준비

**배포 파이프라인**
- [ ] Docker 컨테이너화 전략
- [ ] docker-compose 개발 환경 구성
- [ ] Kubernetes/로드밸런싱 고려 (확장성)
- [ ] CI/CD 파이프라인 GitHub Actions
- [ ] 환경별 설정 관리 (개발/스테이징/프로덕션)

**운영 모니터링**
- [ ] 로깅 시스템 (structlog, ELK 스택)
- [ ] 지표 수집 및 경고 (Prometheus/Grafana)
- [ ] 에러 추적 시스템 (Sentry/Sentry)
- [ ] 상태 확인 엔드포인트 (`/health`)
- [ ] 리소스 사용량 모니터링 (CPU, 메모리, 디스크)

---

## 성공 지표 정의

### 기술적 지표
- **텍스트 추출 정확도**: 텍스트 PDF 기준 98% 이상
- **OCR 처리 성공률**: 스캔 PDF 기준 90% 이상
- **한국어 OCR 정확도**: 95% 이상 (PaddleOCR 기준)
- **변환 처리 시간**: 30MB PDF 기준 30초 이내
- **API 응답 시간**: P99 기준 2초 이내
- **오류 발생률**: 변환 실패율 1% 미만

### 사용자 경험 지표
- **파일 업로드 성공률**: 99% 이상
- **변환 완료율**: 성공적으로 완료된 95% 이상
- **사용자 만족도**: 사용자 피드백 4점 이상 (5점 만점)
- **신규 사용자 유입**: 웹 인터페이스 접속자 수 증가

### 운영 지표
- **시스템 가용성**: 99.9% 이상 (연간 다운타임 8.76시간 미만)
- **배포 성공률**: 배포 시도 중 95% 이상 성공
- **자동 복구 시간**: 장애 발생 후 5분 이내 자동 복구

---

## 위험 관리 계획

### 기술적 리스크
| 리스크 | 가능성 | 영향도 | 대응 전략 |
|-------|--------|--------|----------|
| OCR 정확도 미달 | 중 | 높 | 여러 OCR 엔진 비교, PaddleOCR 도입 검토 |
| 대용량 PDF 처리 실패 | 낮 | 높 | 스트리밍 방식 도입, 메모리 최적화 |
| EPUB 호환성 문제 | 중 | 중 | 주요 리더기별 테스트, 유효성 검증 강화 |
| API 성능 저하 | 중 | 중 | 캐싱 전략, 데이터베이스 튜닝 |

### 일정 리스크
| 리스크 | 가능성 | 영향도 | 완화 조치 |
|-------|--------|--------|----------|
| 개발 지연 | 중 | 중 | 스프린트 단위 진행, 우선순위 조정 |
| 기술적 부채 증가 | 높 | 중 | 정기적인 리팩토링 시간 확보 |
| 외부 의존성 문제 | 낮 | 높 | 대체 기술 준비, 오픈소스 커뮤니티 참여 |

---

## 문서화 계획

### 기술 문서
- [ ] API 명세서 (OpenAPI 3.0)
- [ ] 아키텍처 다이어그램 (Mermaid.js 사용)
- [ ] 배포 가이드 (Docker/Kubernetes)
- [ ] 모니터링 대시보드 구성 설명

### 사용자 문서
- [ ] 사용자 매뉴얼 (웹 인터페이스)
- [ ] CLI 사용법 설명
- [ ] API 호출 가이드 (개발자용)
- [ ] 자주 묻는 질문 (FAQ)

### 내부 문서
- [ ] 코드 컨벤션 가이드
- [ ] 테스트 전략 문서
- [ ] 운영 절차 매뉴얼
- [ ] 장애 대응 프로토콜

---

## 기타 고려사항

### 법적/규정 준수
- [ ] 개인정보 처리 방침 (GDPR, 한국 PPL)
- [ ] 저작권 보호 (EPUB 메타데이터 포함)
- [ ] 서비스 약관 (이용 조건 및 제한)

### 지속적 개선
- [ ] 사용자 피드백 수집 메커니즘
- [ ] 정기적인 성능 리뷰 회의
- [ ] 새로운 OCR 기술 지속적 평가
- [ ] 커뮤니티 기반 기여 장려

---

## 업데이트 로그
- **2024-09-17**: 초기 버전 작성, 프로젝트 개요 및 M0 단계 정의
- **2024-09-17**: 핵심 라이브러리 목록 업데이트 (PaddleOCR로 변경, 의존성 추가)
- **2024-09-19**: VSCode Python 개발 환경 최적화 완료 (.vscode 설정 파일 구성, 코드 품질 도구 설치 및 검증)
- **2025-09-19**: 디버깅 환경 구축 완료 - 로깅 모듈(`app/core/logging_config.py`) 생성, `main.py`에 적용, VSCode 설정 보완, 테스트 및 코드 품질 검사 통과
