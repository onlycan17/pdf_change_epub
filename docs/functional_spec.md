# PDF to EPUB 변환기 - 기능명세서

## 1. 개요

이 문서는 PDF to EPUB 변환기 웹 애플리케이션의 기능적 요구사항을 상세히 정의합니다. 사용자 경험과 시스템 아키텍처를 고려하여 각 기능의 목적, 동작 방식, 입력/출력을 명확히 기술합니다.

## 2. 전체 시스템 아키텍처

```mermaid
graph TD
    A[사용자] --> B[React 프론트엔드]
    B --> C[Supabase 백엔드]
    C --> D[PDF 처리 모듈]
    C --> E[OCR 모듈]
    C --> F[LLM 처리 모듈]
    C --> G[EPUB 생성 모듈]
    C --> H[인증 및 결제 모듈]
    C --> I[광고 시스템]
    D --> J[PDF.js / pdf-lib]
    E --> K[Tesseract.js v5.0+ (OCR: 영어 95%, 한글 90% 정확도)]
    F --> L[DeepSeek-V3.1 (OpenRouter: 1K 토큰당 $0.001)]
    G --> M[EPUB.js / ebook-gen]
    H --> N[Supabase Auth]
    H --> O[Stripe 결제]
    I --> P[Google AdSense]
```

## 3. 주요 기능 상세

### 3.1 PDF 파일 업로드 및 관리

#### 기능 설명
사용자가 PDF 파일을 업로드하고, 변환 과정에서 필요한 파일들을 관리합니다.

#### 동작 방식
1. 사용자는 웹 인터페이스를 통해 PDF 파일을 선택하여 업로드합니다.
2. 시스템은 업로드된 파일을 임시 저장소에 저장합니다.
3. 파일은 일정 기간(예: 24시간) 후 자동으로 삭제됩니다.

#### 입력
- PDF 파일 (형식: .pdf, 크기 제한: 무료 사용자 10MB, 프리미엄 사용자 300MB)

#### 출력
- 업로드 성공/실패 메시지
- 파일 ID (변환 프로세스 추적용)

#### 제약 조건
- 파일 크기 300MB 이하만 허용 (프리미엄 사용자, 스트리밍 처리 및 메모리 최적화 적용)
- PDF 형식이 아닌 파일은 업로드 불가

### 3.2 PDF 텍스트 전처리 및 마크다운 변환

#### 기능 설명
PDF에서 추출한 텍스트를 분석하여 마크다운 형식으로 변환합니다.

#### 동작 방식
1. PDF 처리 모듈이 텍스트를 추출합니다.
2. 추출된 텍스트를 분석하여 제목, 단락, 목록 등으로 구분합니다.
3. 마크다운 형식으로 변환하여 저장합니다.

#### 입력
- PDF 파일 ID

#### 출력
- 마크다운 형식의 텍스트
- 변환 과정 로그

#### 제약 조건
- 암호가 걸린 PDF는 처리 불가
- 이미지 전용 PDF는 별도 OCR 처리 필요

### 3.3 LLM을 활용한 문맥 연결 처리

#### 기능 설명
OpenRouter를 통해 DeepSeek-V3.1 LLM 모델을 사용하여 텍스트의 문맥이 끊어지는 부분을 자연스럽게 연결합니다. 무료 사용자에게는 DeepSeek-V3.1 Free 모델을 제공하며, 일일 사용량을 초과하면 유료 모델로 자동 전환하거나 프리미엄 업그레이드를 유도합니다.

#### 동작 방식
1. 마크다운으로 변환된 텍스트를 분석합니다.
2. 문맥이 끊어지는 부분을 식별합니다.
3. 사용자 상태에 따라 모델 선택:
   - 무료 사용자: DeepSeek-V3.1 Free (일일 제한량 확인)
   - 제한 초과 시: 유료 DeepSeek-V3.1으로 전환 또는 프리미엄 유도
   - 프리미엄 사용자: 무제한 DeepSeek-V3.1 사용
4. OpenRouter API를 호출하여 선택된 모델로 문맥을 자연스럽게 연결합니다.
5. 사용자가 조절할 수 있는 처리 강도 옵션을 제공합니다.

#### 입력
- 마크다운 텍스트
- 문맥 연결 처리 강도 (1-5 단계)

#### 출력
- 문맥이 개선된 마크다운 텍스트

#### 제약 조건
- 무료 사용자: DeepSeek-V3.1 Free 일일 사용량 제한
- 유료 모델 전환 시 비용 발생 (1K 토큰당 $0.001)
- 처리 시간 최적화 (무료/유료 모델에 따른 성능 차이)
- 프리미엄 사용자: 무제한 사용 가능

### 3.4 EPUB 문서 생성 및 다운로드

#### 기능 설명
마크다운 텍스트와 이미지를 EPUB 전자책 형식으로 변환하여 다운로드를 제공합니다.

#### 동작 방식
1. 마크다운 텍스트와 이미지를 EPUB 구조로 변환합니다.
2. 사용자가 입력한 메타데이터(제목, 저자 등)를 EPUB에 추가합니다.
3. 완성된 EPUB 파일을 사용자에게 제공합니다.

#### 입력
- 마크다운 텍스트
- 이미지 파일들
- 메타데이터 (제목, 저자, 언어 등)

#### 출력
- EPUB 파일 다운로드 링크

#### 제약 조건
- EPUB 3.0 표준 준수
- 다양한 리더기 호환성 확보

### 3.5 PDF 이미지 추출 및 배치

#### 기능 설명
PDF에서 이미지를 추출하여 EPUB 문서의 적절한 위치에 배치합니다.

#### 동작 방식
1. PDF에서 이미지를 추출합니다.
2. 마크다운 텍스트에서 이미지 위치를 식별합니다.
3. EPUB 문서에 이미지를 적절히 배치합니다.

#### 입력
- PDF 파일 ID
- 마크다운 텍스트

#### 출력
- 추출된 이미지 파일들
- 이미지 위치 정보

#### 제약 조건
- 이미지 해상도 최적화
- EPUB 파일 크기 관리
- 프리미엄 사용자만 고해상도 이미지 처리 가능

### 3.6 OCR을 통한 스캔본 텍스트 추출

#### 기능 설명
스캔된 PDF 문서에서 Tesseract.js v5.0+ OCR 엔진을 사용하여 텍스트를 추출합니다. (영어 95%, 한글 90% 정확도 목표)

#### 동작 방식
1. PDF가 스캔본인지 판단합니다.
2. Tesseract.js v5.0+를 사용하여 텍스트를 추출합니다 (한국어/영어 언어팩 적용).
3. 추출된 텍스트를 마크다운으로 변환합니다.

#### 입력
- PDF 파일 ID

#### 출력
- OCR로 추출된 텍스트 (마크다운 형식)

#### 제약 조건
- OCR 정확도 향상을 위한 이미지 전처리
- 다양한 글꼴과 언어 지원
- 프리미엄 사용자만 사용 가능

### 3.7 사용자 인증 (구글 로그인)

#### 기능 설명
사용자가 구글 계정을 통해 서비스에 로그인할 수 있도록 합니다.

#### 동작 방식
1. 사용자가 "구글로 로그인" 버튼을 클릭합니다.
2. Supabase Auth를 통해 구글 OAuth 인증을 수행합니다.
3. 인증 성공 시 사용자 정보를 저장하고 세션을 생성합니다.

#### 입력
- 구글 계정 인증 정보

#### 출력
- 사용자 세션
- 사용자 프로필 정보 (이메일 등)

#### 제약 조건
- 구글 계정이 필요
- HTTPS 환경에서만 동작

### 3.8 결제 시스템 (Stripe)

#### 기능 설명
사용자가 프리미엄 기능을 사용하기 위해 Stripe를 통해 결제할 수 있도록 합니다.

#### 동작 방식
1. 사용자가 프리미엄 기능을 선택합니다.
2. Stripe 결제 페이지로 리디렉션됩니다.
3. 신용카드 정보를 입력하여 결제합니다.
4. 결제 성공 시 사용자 계정에 프리미엄 권한이 부여됩니다.

#### 입력
- 신용카드 정보
- 결제 금액

#### 출력
- 결제 성공/실패 메시지
- 사용자 계정에 프리미엄 권한 부여

#### 제약 조건
- Stripe 계정 필요
- HTTPS 환경에서만 동작

### 3.9 광고 시스템

#### 기능 설명
무료 사용자에게 Google AdSense 광고를 표시하여 수익을 창출합니다.

#### 동작 방식
1. 무료 사용자가 서비스를 이용할 때 광고를 표시합니다.
2. 광고 클릭 및 노출에 따른 수익을 창출합니다.
3. 프리미엄 사용자에게는 광고를 표시하지 않습니다.

#### 입력
- 사용자 상태 (무료/프리미엄)
- 광고 슬롯 정보

#### 출력
- 광고 콘텐츠 표시
- 광고 수익 데이터

#### 제약 조건
- Google AdSense 정책 준수
- 광고 차단기 감지 및 대응

## 4. 보조 기능

### 4.1 진행 상황 표시
- 파일 업로드 상태 표시
- 변환 과정 진행률 표시
- 예상 완료 시간 표시

### 4.2 에러 처리 및 로깅
- 각 단계별 에러 메시지 표시
- 상세 로그 기록 및 확인 기능

### 4.3 메타데이터 수정
- EPUB 메타데이터(제목, 저자, 언어 등) 수정 기능
- 미리보기 기능

## 5. 성능 요구사항

### 5.1 처리 속도
- 일반 PDF (50페이지 이하): 30초 이내
- 대용량 PDF (100페이지 이상): 1분 이내
- 스캔본 PDF OCR: 페이지당 2초 이내

### 5.2 동시 처리
- 최대 10개의 PDF 파일 동시 처리 지원

### 5.3 메모리 사용량
- 단일 PDF 처리 시 최대 512MB RAM 사용 (스트리밍 처리, 청크 단위 처리, Web Workers 활용)
- 300MB 파일 처리 시 메모리 최적화: 페이지별 처리, 임시 파일 즉시 정리, 캐싱 전략 적용

## 6. 보안 요구사항

### 6.1 파일 보안
- 업로드된 파일은 암호화하여 저장
- 파일 접근 권한 엄격히 관리

### 6.2 데이터 보안
- 사용자 데이터는 최소한으로 수집 및 저장
- 개인정보는 24시간 이내 파기

### 6.3 API 보안
- OpenRouter API 키는 서버 사이드에서만 관리 (DeepSeek-V3.1 모델용)
- API 호출은 rate limiting 적용 (토큰 사용량 모니터링 및 비용 최적화)

### 6.4 인증 보안
- OAuth 2.0을 통한 안전한 인증
- 세션 관리 및 CSRF 보호

### 6.5 광고 보안
- 광고 스크립트는 신뢰할 수 있는 소스만 허용
- 광고 차단기 감지 시 대체 콘텐츠 제공

## 7. 호환성 요구사항

### 7.1 브라우저 호환성
- 최신 Chrome, Firefox, Safari 지원
- 모바일 브라우저 호환

### 7.2 EPUB 호환성
- EPUB 3.0 표준 준수
- Kindle, Apple Books, Google Play Books 등 주요 리더기 호환

## 8. 확장성 고려사항

### 8.1 기능 확장
- 다른 전자책 형식(MOBI, AZW 등) 지원
- 음성 합성 기능 추가

### 8.2 성능 확장
- 클라우드 기반 처리 엔진으로 확장 가능
- 분산 처리 아키텍처 지원

이 기능명세서는 프로젝트 개발의 기준이 되며, 개발 과정에서 필요에 따라 업데이트될 수 있습니다.