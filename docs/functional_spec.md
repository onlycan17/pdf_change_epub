# 기능 명세서

## 1. 개요
이 문서는 PDF → EPUB 변환기의 기능적 요구사항과 구현 세부사항을 정의합니다. 특히 한국어 처리에 최적화된 OCR 기능과 React 기반 웹 인터페이스를 포함합니다.

## 2. 주요 기능

### 2.1 PDF 파싱 및 텍스트 추출
- **기능 설명**: PDF 파일에서 텍스트와 이미지를 추출합니다.
- **기술 스택**: PyPDF2/pdfminer.six
- **요구사항**:
  - 텍스트 기반 PDF에서 텍스트와 이미지 정확한 추출
  - 스캔된 PDF 자동 감지
  - 추출된 텍스트의 인코딩 문제 해결 (특히 한국어)

### 2.2 OCR 처리 (한국어 특화)
- **기능 설명**: 스캔된 PDF에 대해 OCR을 수행하여 텍스트를 추출합니다.
- **기술 스택**: PaddleOCR + 한국어 특화 모델
- **요구사항**:
  - 한국어 텍스트 인식 정확도 95% 이상 (PaddleOCR의 PP-OCRv3 모델 사용)
  - 영어/한국어 혼합 문서 처리 지원
  - OCR 처리 실패 시 에러 로그 상세 기록
  - 다양한 DPI의 이미지 처리 지원 (DPI 자동 최적화)
  - 경량 모델 사용으로 서버 환경 최적화 (모델 크기 약 90MB)
  - CPU 환경에서도 빠른 처리 속도 (100ms/텍스트 라인 이내)
  - Text Detection과 Recognition을 통합 처리

### 2.3 EPUB 생성
- **기능 설명**: 추출된 텍스트와 이미지로 EPUB 파일을 생성합니다.
- **기술 스택**: ebooklib
- **요구사항**:
  - EPUB3 표준 준수
  - 목차 자동 생성
  - 메타데이터(제목, 저자 등) 포함
  - 이미지 최적화 및 WebP 변환

### 2.4 REST API
- **기능 설명**: 변환 서비스를 외부에서 호출할 수 있도록 REST API를 제공합니다.
- **기술 스택**: FastAPI
- **요구사항**:
  - 파일 업로드 및 변환 요청
  - 변환 진행 상황 조회
  - 변환 결과 다운로드
  - 에러 처리 및 상세한 응답 메시지

### 2.5 웹 프론트엔드 (React)
- **기능 설명**: 사용자 친화적인 웹 인터페이스를 제공합니다.
- **기술 스택**: React 18+, TypeScript
- **요구사항**:
  - 파일 드래그 앤 드롭
  - 변환 진행 상황 실시간 표시
  - 변환 결과 다운로드
  - 반응형 디자인
  - 다크 모드 지원

## 3. 상세 기능 명세

### 3.1 PDF 파싱 모듈
- **입력**: PDF 파일
- **출력**: 텍스트, 이미지, 메타데이터
- **처리 과정**:
  1. PDF 파일 유효성 검사
  2. 텍스트 기반 PDF 여부 확인
  3. 텍스트 및 이미지 추출
  4. 메타데이터 추출

### 3.2 OCR 처리 모듈
- **입력**: 스캔된 PDF 파일 또는 이미지
- **출력**: 추출된 텍스트
- **처리 과세**:
  1. 스캔된 PDF 자동 감지
  2. 이미지 DPI 확인 및 필요시 조정
  3. pytesseract를 사용한 OCR 처리 (한국어 언어팩 적용)
  4. OCR 결과 후처리 (특수문자 정리, 줄바꿈 처리 등)

### 3.3 EPUB 생성 모듈
- **입력**: 텍스트, 이미지, 메타데이터
- **출력**: EPUB 파일
- **처리 과정**:
  1. EPUB 구조 생성
  2. 텍스트 및 이미지 삽입
  3. 목차 자동 생성
  4. 메타데이터 적용
  5. EPUB 파일 생성 및 검증

### 3.4 REST API 엔드포인트
- **POST /api/convert**: 파일 업로드 및 변환 요청
- **GET /api/status/{task_id}**: 변환 진행 상황 조회
- **GET /api/download/{task_id}**: 변환 결과 다운로드
- **GET /api/languages**: 지원 언어 목록 조회

### 3.5 웹 프론트엔드
- **주요 컴포넌트**:
  - 파일 업로드 컴포넌트
  - 진행 상황 표시 컴포넌트
  - 결과 표시 및 다운로드 컴포넌트
  - 설정 컴포넌트 (언어 선택 등)
- **주요 기능**:
  - 파일 드래그 앤 드롭
  - 진행 상황 실시간 업데이트
  - 다운로드 링크 제공
  - 에러 메시지 표시

## 4. 데이터 구조

### 4.1 변환 작업
```json
{
  "task_id": "string",
  "status": "pending|processing|completed|failed",
  "progress": "number (0-100)",
  "file_name": "string",
  "file_size": "number",
  "created_at": "datetime",
  "completed_at": "datetime",
  "error_message": "string"
}
```

### 4.2 메타데이터
```json
{
  "title": "string",
  "author": "string",
  "language": "string",
  "publisher": "string",
  "publication_date": "date"
}
```

## 5. 에러 처리
- **파일 업로드 에러**: 잘못된 파일 형식, 파일 크기 초과 등
- **OCR 에러**: 언어팩 미설치, 이미지 품질 문제 등
- **EPUB 생성 에러**: 메타데이터 누락, 파일 생성 실패 등
- **API 에러**: 잘못된 요청, 서버 내부 에러 등

## 6. 보안 요구사항
- 파일 업로드 시 확장자 및 MIME 타입 검증
- 업로드된 파일은 일정 시간 후 자동 삭제
- API 접근을 위한 인증/인가 (향후 확장)
- XSS 및 CSRF 방지

---
이 문서는 PDF → EPUB 변환기의 기능적 요구사항을 정의하며, 구현 시 참고해야 할 상세한 명세를 포함합니다.
