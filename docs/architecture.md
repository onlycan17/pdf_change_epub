# 아키텍처 설계서

## 1. 개요
이 문서는 PDF → EPUB 변환기의 시스템 아키텍처를 정의합니다. 특히 한국어 처리에 최적화되고 React 기반 웹 인터페이스를 제공하는 고성능, 확장 가능한 아키텍처를 설계합니다.

## 2. 전체 아키텍처 다이어그램

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                              클라이언트                                     │
├─────────────────────────────────────────────────────────────────────────────┤
│                        Web Browser (React)                                  │
└───────────────────────────────┬─────────────────────────────────────────────┘
                                │ HTTP/HTTPS
┌───────────────────────────────▼─────────────────────────────────────────────┐
│                              API Gateway                                    │
├─────────────────────────────────────────────────────────────────────────────┤
│                        Load Balancer (향후 확장)                            │
└───────────────────────────────┬─────────────────────────────────────────────┘
                                │
┌───────────────────────────────▼─────────────────────────────────────────────┐
│                           Web 서버 (FastAPI)                               │
├─────────────────────────────┬───────────────────────────────────────────────┤
│        REST API 컨트롤러    │        백그라운드 작업 큐 (향후 확장)         │
└─────────────┬───────────────┴───────────────────────────────────────────────┘
              │
┌─────────────▼───────────────────────────────────────────────────────────────┐
│                           서비스 레이어                                      │
├─────────────┬─────────────┬──────────────┬─────────────┬────────────────────┤
│  PDF 서비스  │  OCR 서비스  │ EPUB 서비스  │ 파일 서비스  │ 인증 서비스 (향후 확장) │
└─────────────┴─────────────┴──────────────┴─────────────┴────────────────────┘
              │
┌─────────────▼───────────────────────────────────────────────────────────────┐
│                           데이터 액세스 레이어                              │
├─────────────────────────────────────────────────────────────────────────────┤
│              데이터베이스 (SQLite/PostgreSQL)                               │
└─────────────────────────────────────────────────────────────────────────────┘
              │
┌─────────────▼───────────────────────────────────────────────────────────────┐
│                           파일 시스템                                       │
├─────────────────────────────────────────────────────────────────────────────┤
│        업로드된 PDF 파일, 생성된 EPUB 파일, 임시 파일 등                   │
└─────────────────────────────────────────────────────────────────────────────┘
```

## 3. 컴포넌트 상세 설계

### 3.1 웹 프론트엔드 (React)
- **책임**: 사용자 인터페이스 제공, 사용자 입력 처리, 서버와의 통신
- **주요 기능**:
  - 파일 업로드 및 드래그 앤 드롭
  - 변환 진행 상황 표시
  - 변환 결과 표시 및 다운로드
  - 설정 옵션 제공 (OCR 언어, 메타데이터 등)
- **기술 스택**: React 18+, TypeScript, Vite, React Router DOM

### 3.2 API 게이트웨이
- **책임**: 클라이언트 요청의 진입점, 요청 라우팅, 인증/인가 처리
- **주요 기능**:
  - 요청 라우팅
  - CORS 처리
  - 기본적인 요청/응답 로깅
  - 레이트 리미팅 (향후 확장)
- **기술 스택**: FastAPI (내장 기능으로 구현)

### 3.3 웹 서버 (FastAPI)
- **책임**: REST API 엔드포인트 제공, 비즈니스 로직 조정
- **주요 기능**:
  - 파일 업로드 및 다운로드 처리
  - 변환 작업 상태 관리
  - 에러 처리 및 응답 생성
- **기술 스택**: FastAPI, Pydantic

### 3.4 서비스 레이어

#### 3.4.1 PDF 서비스
- **책임**: PDF 파일 파싱 및 텍스트/이미지 추출
- **주요 기능**:
  - PDF 파일 유효성 검사
  - 텍스트 기반 PDF와 스캔된 PDF 구분
  - 텍스트 및 이미지 추출
  - 메타데이터 추출
- **기술 스택**: PyPDF2, pdfminer.six

#### 3.4.2 OCR 서비스
- **책임**: 스캔된 PDF에 대한 OCR 처리
- **주요 기능**:
  - 스캔된 PDF 자동 감지
  - 이미지 전처리 (DPI 조정, 노이즈 제거 등)
  - PaddleOCR을 통한 OCR 처리 (한국어 특화 모델 적용)
  - OCR 결과 후처리
- **기술 스택**: PaddleOCR, PIL/Pillow

#### 3.4.3 EPUB 서비스
- **책임**: 추출된 콘텐츠로 EPUB 파일 생성
- **주요 기능**:
  - EPUB 구조 생성
  - 텍스트 및 이미지 삽입
  - 목차 자동 생성
  - 메타데이터 적용
  - EPUB 파일 검증
- **기술 스택**: ebooklib

#### 3.4.4 파일 서비스
- **책임**: 파일 관리 및 임시 파일 처리
- **주요 기능**:
  - 파일 업로드/다운로드 처리
  - 임시 파일 생성 및 관리
  - 파일 삭제 및 정리
- **기술 스택**: Python 표준 라이브러리

### 3.5 데이터 액세스 레이어
- **책임**: 영구 데이터 저장 및 조회
- **주요 기능**:
  - 변환 작업 기록 저장
  - 사용자 정보 관리 (향후 확장)
  - 설정 정보 저장
- **기술 스택**: SQLAlchemy, SQLite/PostgreSQL

### 3.6 파일 시스템
- **책임**: 파일 저장 및 관리
- **주요 기능**:
  - 업로드된 PDF 파일 저장
  - 생성된 EPUB 파일 저장
  - 임시 파일 저장
  - 파일 자동 삭제 (일정 시간 후)

## 4. 데이터 흐름

### 4.1 파일 업로드 및 변환 요청
1. 사용자가 웹 인터페이스를 통해 PDF 파일 업로드
2. React 프론트엔드가 파일을 API 서버로 전송
3. API 서버가 파일을 임시 저장소에 저장
4. 변환 작업 요청이 작업 큐에 등록 (동기식 또는 비동기식)

### 4.2 PDF 처리
1. PDF 서비스가 파일을 분석하여 텍스트 기반인지 스캔된 것인지 판단
2. 텍스트 기반 PDF의 경우 직접 텍스트 추출
3. 스캔된 PDF의 경우 OCR 서비스로 전달

### 4.3 OCR 처리
1. OCR 서비스가 이미지 전처리 수행
2. pytesseract를 사용하여 OCR 처리 (한국어 언어팩 적용)
3. OCR 결과를 후처리하여 정제된 텍스트 생성

### 4.4 EPUB 생성
1. 추출된 텍스트와 이미지를 EPUB 서비스로 전달
2. EPUB 서비스가 메타데이터와 함께 EPUB 파일 생성
3. 생성된 EPUB 파일을 파일 시스템에 저장

### 4.5 결과 반환
1. 변환 완료 후 결과 정보를 데이터베이스에 저장
2. 사용자가 결과 조회 요청 시 API 서버가 정보 반환
3. 사용자가 EPUB 파일 다운로드 시 파일 서비스가 파일 전송

## 5. 확장성 설계

### 5.1 수평 확장
- **웹 서버**: 여러 인스턴스로 확장 가능
- **작업 큐**: 백그라운드 작업을 분산 처리
- **데이터베이스**: 클러스터링을 통한 확장

### 5.2 마이크로서비스 아키텍처
- 각 서비스는 독립적으로 배포 및 확장 가능
- 서비스 간 통신은 REST API 또는 메시지 큐를 통해 처리

### 5.3 캐싱 전략
- 자주 사용하는 데이터는 Redis와 같은 인메모리 캐시에 저장
- EPUB 템플릿 등 정적 리소스는 CDN을 통해 제공

## 6. 보안 설계

### 6.1 데이터 보안
- 업로드된 파일은 일정 시간 후 자동 삭제
- 민감한 데이터는 암호화하여 저장
- 데이터베이스 접근은 최소 권한 원칙 적용

### 6.2 네트워크 보안
- HTTPS를 통한 모든 통신 암호화
- CORS 정책을 통한 외부 접근 제한
- 입력 데이터에 대한 검증 및 필터링

### 6.3 인증 및 인가
- API 키 또는 OAuth를 통한 인증 (향후 확장)
- 역할 기반 접근 제어 (RBAC) 구현

## 7. 성능 최적화

### 7.1 PDF 처리 최적화
- 대용량 PDF는 페이지 단위로 스트리밍 처리
- 병렬 처리를 통한 처리 속도 향상
- 중간 결과 캐싱을 통한 재처리 방지

### 7.2 메모리 관리
- Web Workers를 활용한 백그라운드 처리
- 메모리 사용량 모니터링 및 제한
- 불필요한 객체는 즉시 가비지 컬렉션

### 7.3 네트워크 최적화
- 응답 압축을 통한 전송 속도 향상
- CDN을 통한 정적 리소스 캐싱
- 연결 풀을 통한 데이터베이스 연결 최적화

## 8. 모니터링 및 로깅

### 8.1 로깅 전략
- 모든 중요한 이벤트에 대한 구조화된 로깅
- 에러 발생 시 상세한 스택 트레이스 기록
- 로그 레벨에 따른 분류 (DEBUG, INFO, WARNING, ERROR, CRITICAL)

### 8.2 모니터링
- 시스템 리소스 사용량 모니터링 (CPU, 메모리, 디스크)
- API 응답 시간 및 성공률 모니터링
- 변환 작업 처리량 및 실패율 모니터링

### 8.3 알림 시스템
- 에러 발생 시 실시간 알림
- 성능 임계값 초과 시 알림
- 시스템 장애 시 즉각적인 알림

## 9. 배포 아키텍처

### 9.1 개발 환경
- 로컬 개발용 Docker 컨테이너
- 핫 리로딩을 통한 빠른 개발 피드백
- 단위 테스트 및 통합 테스트 자동 실행

### 9.2 스테이징 환경
- 운영 환경과 동일한 구성
- 자동화된 테스트 스위트 실행
- 성능 테스트 및 부하 테스트 수행

### 9.3 운영 환경
- 클라우드 플랫폼 (AWS, GCP, Azure)에 배포
- 자동 스케일링 구성
- 지오레플리케이션을 통한 고가용성 확보

## 10. 백업 및 복구 전략

### 10.1 데이터 백업
- 정기적인 데이터베이스 백업
- 중요한 설정 및 메타데이터 백업
- 백업 데이터의 암호화 및 안전한 저장

### 10.2 재해 복구
- 클라우드 기반 재해 복구 계획
- 자동화된 복구 절차
- 복구 시간 목표(RTO) 및 복구 지점 목표(RPO) 정의

---
이 문서는 PDF → EPUB 변환기의 시스템 아키텍처를 정의하며, 각 컴포넌트의 책임과 상호작용을 상세히 설명합니다.
