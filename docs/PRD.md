# 제품 요구사항 문서 (PRD) - MVP v2

## 1. 개요
- **제품명**: PDF to EPUB Converter
- **MVP 목표**: Supabase, React, FastAPI를 기반으로 PDF를 EPUB으로 변환하는 웹 애플리케이션. LLM을 활용한 고품질 변환(문맥 교정, OCR 오타 수정)을 차별점으로 하며, 사용자 등급별(무료/유료) 서비스를 제공한다.

## 2. 사용자 등급 및 정책
서비스는 무료 및 유료 플랜으로 운영됩니다.

| 등급 | 로그인 필요 여부 | 파일 크기 제한 | 주요 기능 |
| :--- | :--- | :--- | :--- |
| **무료 사용자** | 선택 (필수 아님) | 20MB | • 기본 변환 기능<br>• 소용량 파일 OCR 지원 |
| **단일 결제 사용자** | 필수 | 100MB / 200MB / 300MB | • 구매한 용량만큼 대용량 파일 변환<br>• 모든 LLM 보정 기능 |
| **구독 사용자** | 필수 | 플랜별 상이 | • 월별 제공량 내에서 변환<br>• 모든 기능 우선 지원 |

## 3. 사용자 시나리오
1.  **무료 사용자 (방문객)**: 회원가입 없이 빠르게 작은 크기의 PDF를 EPUB으로 변환해보고 서비스의 품질을 경험한다.
2.  **단일 결제 사용자 (학생/연구원)**: 두꺼운 전공서적이나 논문 PDF(예: 150MB)를 변환하기 위해 일회성으로 결제하고 고품질의 EPUB 파일을 얻는다.
3.  **구독 사용자 (전문가/기관)**: 정기적으로 다수의 문서를 변환해야 하므로, 구독 플랜을 통해 비용 효율적으로 서비스를 이용한다.

## 4. 핵심 기능 요구사항 (Features)

| ID | 기능 설명 | 등급 | 우선순위 | 비고 |
| :--- | :--- | :--- | :--- | :--- |
| FEAT-01 | **사용자 인증** | 유료 | ★★★ | Supabase Auth (이메일/비밀번호) |
| FEAT-02 | **익명 사용자 지원** | 무료 | ★★★ | 로그인 없이 서비스 이용 (세션 기반) |
| FEAT-03 | **PDF 파일 업로드** | 전체 | ★★★ | 등급별 용량 제한 적용 |
| FEAT-04 | **PDF → 마크다운 변환** | 전체 | ★★★ | 텍스트/이미지를 추출하여 마크다운 형식으로 저장 |
| FEAT-05 | **LLM 기반 문맥/오타 보정** | 전체 | ★★★ | LLM API를 사용하여 끊어진 문맥을 잇고 OCR 오타를 수정 |
| FEAT-06 | **사용자 OCR 선택권 제공** | 전체 | ★★☆ | 스캔된 PDF 감지 후, 사용자에게 OCR 사용 여부 선택권 부여 |
| FEAT-07 | **EPUB 생성 및 다운로드** | 전체 | ★★★ | 보정된 마크다운을 기반으로 EPUB 파일을 생성하고 다운로드 링크 제공 |
| FEAT-08 | **실시간 변환 상태 추적** | 전체 | ★★★ | Supabase Realtime을 통해 변환 단계(파싱, LLM, 생성 등) 표시 |
| FEAT-09 | **결제 시스템 연동** | 유료 | ★★★ | Stripe 또는 포트원을 통한 단일/구독 결제 |
| FEAT-10 | **변환 내역 조회** | 유료 | ★★☆ | 로그인 사용자의 과거 변환 작업 목록 조회 |
| FEAT-11 | **다국어 지원 (i18n)** | 전체 | ★★☆ | UI(한/영) 및 OCR 언어(한/영) 선택 |

## 5. 기능 명세 (Functional Specifications)

### 5.1. 변환 파이프라인
1.  **PDF 분석**: 업로드된 PDF가 텍스트 기반인지 이미지 기반(스캔)인지 분석.
2.  **사용자 확인 (옵션)**: 스캔 PDF로 판단될 경우, 사용자에게 OCR 기능 사용 여부를 묻는 UI를 표시.
3.  **1차 추출 (PDF → Markdown)**:
    *   **텍스트 PDF**: 텍스트와 이미지 객체를 추출하여 마크다운 파일로 저장.
    *   **스캔 PDF (OCR 사용 시)**: 페이지를 이미지로 분할하고, PaddleOCR을 통해 텍스트를 추출. 추출된 텍스트와 이미지를 마크다운 파일로 저장.
4.  **2차 보정 (Markdown → LLM → Markdown)**:
    *   생성된 마크다운의 텍스트를 LLM API에 전달.
    *   **요청**: "다음 텍스트의 문맥을 자연스럽게 다듬고, 명백한 오타를 수정해줘."
    *   LLM이 수정한 텍스트로 마크다운 파일을 업데이트.
5.  **최종 생성 (Markdown → EPUB)**:
    *   보정된 마크다운 파일과 이미지들을 `ebooklib`을 사용하여 EPUB3 형식으로 패키징.
    *   추출된 이미지가 올바른 위치에 포함되도록 처리.

### 5.2. LLM 에이전트 (이미지 처리)
- 변환 과정에서 추출된 이미지는 단순 포함을 넘어, LLM(Vision 모델)을 활용하여 이미지의 내용을 분석하고 적절한 위치나 설명을 제안하는 기능을 장기적으로 고려. (MVP에서는 순서대로 포함)

## 6. 비기능 요구사항
- **성능**: LLM API 호출 시간을 포함하여, 100MB PDF 기준 3~5분 내외 변환 완료 목표.
- **보안**: 익명 사용자의 경우, 업로드된 파일과 결과물은 24시간 후 자동 삭제.
- **API 비용 관리**: LLM 및 OCR 사용량에 대한 모니터링 및 로깅 체계 구축.

## 7. 성공 지표
- **품질 지표**: 변환된 EPUB 파일의 문맥 자연스러움 및 오타율에 대한 사용자 만족도.
- **전환율 지표**: 무료 사용자가 유료 플랜으로 전환하는 비율.
