# 제품 요구사항 문서 (PRD) - MVP v2

## 1. 개요
- **제품명**: PDF to EPUB Converter
- **MVP 목표**: Supabase, React, FastAPI를 기반으로 PDF를 EPUB으로 변환하는 웹 애플리케이션. LLM을 활용한 고품질 변환(문맥 교정, OCR 오타 수정)을 차별점으로 하며, 사용자 등급별(무료/유료) 서비스를 제공한다.

## 2. 사용자 등급 및 정책
서비스는 무료 및 유료 플랜으로 운영됩니다.

| 등급 | 로그인 필요 여부 | 파일 크기 제한 | 주요 기능 |
| :--- | :--- | :--- | :--- |
| **무료 사용자** | 선택 (필수 아님) | 20MB | • 기본 변환 기능<br>• 소용량 파일 OCR 지원 |
| **단일 결제 사용자** | 필수 | 100MB / 200MB / 300MB | • 구매한 용량만큼 대용량 파일 변환<br>• 모든 LLM 보정 기능 |
| **구독 사용자** | 필수 | 플랜별 상이 | • 월별 제공량 내에서 변환<br>• 모든 기능 우선 지원 |

**가격 책정 참고사항**:
- 최종 결제 금액은 파일 크기뿐만 아니라, **LLM 및 OCR 사용량(페이지 수, 텍스트 밀도 등)에 따라 변동될 수 있습니다.**
- 이는 더 합리적인 비용 구조를 만들기 위함이며, 사용자에게 변환 시작 전 예상 비용을 투명하게 안내해야 합니다.

## 3. 사용자 시나리오
1.  **무료 사용자 (방문객)**: 회원가입 없이 빠르게 작은 크기의 PDF를 EPUB으로 변환해보고 서비스의 품질을 경험한다.
2.  **단일 결제 사용자 (학생/연구원)**: 두꺼운 전공서적이나 논문 PDF(예: 150MB)를 변환하기 위해 일회성으로 결제하고 고품질의 EPUB 파일을 얻는다.
3.  **구독 사용자 (전문가/기관)**: 정기적으로 다수의 문서를 변환해야 하므로, 구독 플랜을 통해 비용 효율적으로 서비스를 이용한다.

## 4. 핵심 기능 요구사항 (Features)

| ID | 기능 설명 | 등급 | 우선순위 | 비고 |
| :--- | :--- | :--- | :--- | :--- |
| FEAT-01 | **사용자 인증** | 유료 | ★★★ | Supabase Auth (이메일/비밀번호) |
| FEAT-02 | **익명 사용자 지원** | 무료 | ★★★ | 로그인 없이 서비스 이용 (세션 기반) |
| FEAT-03 | **PDF 파일 업로드** | 전체 | ★★★ | 등급별 용량 제한 적용 |
| FEAT-04 | **PDF → 마크다운 변환** | 전체 | ★★★ | 텍스트/이미지를 추출하여 마크다운 형식으로 저장 |
| FEAT-05 | **LLM 기반 문맥/오타 보정** | 전체 | ★★★ | LLM API를 사용하여 끊어진 문맥을 잇고 OCR 오타를 수정 |
| FEAT-06 | **사용자 OCR 선택권 제공** | 전체 | ★★☆ | 스캔된 PDF 감지 후, 사용자에게 OCR 사용 여부 선택권 부여 |
| FEAT-07 | **EPUB 생성 및 다운로드** | 전체 | ★★★ | 보정된 마크다운을 기반으로 EPUB 파일을 생성하고 다운로드 링크 제공 |
| FEAT-08 | **실시간 변환 상태 추적** | 전체 | ★★★ | Supabase Realtime을 통해 변환 단계(파싱, LLM, 생성 등) 표시 |
| FEAT-09 | **결제 시스템 연동** | 유료 | ★★★ | Stripe 또는 포트원을 통한 단일/구독 결제 |
| FEAT-10 | **변환 내역 조회** | 유료 | ★★☆ | 로그인 사용자의 과거 변환 작업 목록 조회 |
| FEAT-11 | **다국어 지원 (i18n)** | 전체 | ★★☆ | UI(한/영) 및 OCR 언어(한/영) 선택 |

## 5. 기능 명세 (Functional Specifications)

### 5.1. 변환 파이프라인
1.  **PDF 분석**: 업로드된 PDF가 텍스트 기반인지 이미지 기반(스캔)인지 분석하여 워크플로우를 결정합니다.
2.  **사용자 확인 (옵션)**: 스캔 PDF로 판단될 경우, 사용자에게 OCR 기능 사용 여부를 묻는 UI를 표시합니다.

---

#### **워크플로우 A: 텍스트 기반 PDF**

1.  **1차 추출 (PDF → Markdown)**:
    *   PDF에서 텍스트 블록과 이미지 객체를 순서대로 직접 추출합니다.
    *   추출된 콘텐츠를 조합하여 초기 마크다운 파일을 생성합니다.

2.  **2차 보정 (Markdown → LLM → Markdown)**:
    *   생성된 마크다운의 텍스트를 LLM API에 전달하여 문맥을 다듬고 오타를 수정합니다.
    *   LLM이 수정한 텍스트로 마크다운 파일을 업데이트합니다.

3.  **최종 생성 (Markdown → EPUB)**:
    *   보정된 마크다운 파일과 추출된 이미지들을 `ebooklib`을 사용하여 EPUB3 형식으로 패키징합니다.

---

#### **워크플로우 B: 스캔 기반 PDF (에이전트 모델)**

1.  **1차 추출 (에이전트 기반 PDF → Markdown)**:
    *   **이미지 처리 에이전트**: 페이지 이미지를 **멀티모달 LLM(Vision 모델)**에 전달하여 이미지 내의 시각적 컨텍스트(예: 다이어그램, 사진, 캡션)를 분석하고 설명을 생성합니다.
    *   **텍스트 처리 에이전트**: **OCR 서비스**(예: PaddleOCR)를 통해 각 페이지에서 텍스트를 정밀하게 추출합니다.
    *   **콘텐츠 종합**: 두 에이전트의 결과(이미지 설명, OCR 텍스트)를 의미론적으로 결합하여, 내용의 흐름에 맞게 이미지와 텍스트가 배치된 초기 마크다운 파일을 생성합니다.

2.  **2차 보정 (Markdown → LLM → Markdown)**:
    *   **청크 분할**: 대용량 문서의 경우, LLM의 컨텍스트 길이 제한과 안정적인 처리를 위해 마크다운 텍스트를 의미 있는 단위(예: 문단, 섹션)로 분할(Chunking)합니다.
    *   생성된 마크다운의 텍스트(OCR 결과 포함)를 청크 단위로 LLM API에 전달하여, OCR 과정에서 발생한 오류를 수정하고 전체 문맥을 자연스럽게 교정합니다.
    *   LLM이 수정한 텍스트로 마크다운 파일을 업데이트합니다.

3.  **최종 생성 (Markdown → EPUB)**:
    *   최종 보정된 마크다운 파일과 추출된 이미지들을 `ebooklib`을 사용하여 EPUB3 형식으로 패키징합니다.



## 6. 비기능 요구사항
- **성능**: LLM API 호출 시간을 포함하여, 100MB PDF 기준 3~5분 내외 변환 완료 목표.
- **확장성**: 대용량 문서(수백 페이지 이상) 처리를 위해 청크(Chunk) 기반의 파이프라인을 적용하여 메모리 사용량을 최적화하고, 안정적인 처리를 보장합니다.
- **보안**: 익명 사용자의 경우, 업로드된 파일과 결과물은 24시간 후 자동 삭제.
- **API 비용 관리**: LLM 및 OCR 사용량에 대한 모니터링 및 로깅 체계 구축.

## 7. 성공 지표
- **품질 지표**: 변환된 EPUB 파일의 문맥 자연스러움 및 오타율에 대한 사용자 만족도.
- **전환율 지표**: 무료 사용자가 유료 플랜으로 전환하는 비율.
